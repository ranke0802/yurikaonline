<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- PWA Manifest & Settings -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2d3436">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js?v=0.29.19')
                    .then(reg => console.log('SW registered:', reg.scope))
                    .catch(err => console.log('SW failed:', err));
            });
        }
    </script>

    <!-- Firebase SDKs (Compat version for HTML/JS) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- Firebase Config -->
    <script src="src/js/firebaseConfig.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&family=Nanum+Gothic:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Yurika Online v0.29.19</title>

    <link rel="icon" type="image/webp" href="src/assets/icon_192.webp">
    <script>
        window.GAME_VERSION = '0.29.19';

        async function initCacheBusting() {
            try {
                const response = await fetch('version.txt?t=' + Date.now(), { cache: 'no-store' });
                const serverVersion = (await response.text()).trim();

                if (serverVersion && window.GAME_VERSION !== serverVersion) {
                    console.log(`New version detected: ${window.GAME_VERSION} -> ${serverVersion}. Reloading...`);
                    window.location.reload(true);
                }
            } catch (e) {
                console.log('Version check failed:', e);
            }
        }
        initCacheBusting();
    </script>
    <link rel="stylesheet" href="src/css/style.css?v=0.29.19">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body>
    <div id="game-container">
        <!-- Loading Overlay -->
        <div id="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div class="loading-text">Yurika Online Î°úÎî© Ï§ë...</div>
                <div class="loading-progress-bar">
                    <div id="loading-progress-fill"></div>
                </div>
            </div>
        </div>

        <div id="game-viewport">
            <!-- Game Canvas -->
            <canvas id="gameCanvas"></canvas>

            <!-- UI Overlay -->
            <div id="ui-layer">
                <!-- Top Bar: HP/MP/Portrait -->
                <div class="top-bar">
                    <div class="portrait-container">
                        <div class="portrait"></div>
                        <div class="level-badge">Level: <span id="ui-level">1</span></div>
                    </div>
                    <div class="stats-container">
                        <div class="stat-row">
                            <span class="stat-label">HP</span>
                            <div class="bar-bg hp-bg">
                                <div class="bar-fill hp-fill"></div>
                                <div class="bar-text">
                                    <span id="ui-hp-cur">0</span> / <span id="ui-hp-max">0</span>
                                </div>
                            </div>
                            <div id="ui-hp-regen-container" class="regen-container"></div>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">MP</span>
                            <div class="bar-bg mp-bg">
                                <div class="bar-fill mp-fill"></div>
                                <div class="bar-text">
                                    <span id="ui-mp-cur">0</span> / <span id="ui-mp-max">0</span>
                                </div>
                            </div>
                            <div id="ui-mp-regen-container" class="regen-container"></div>

                        </div>
                        <div class="stat-row exp-row">
                            <div class="bar-bg exp-bg">
                                <div class="bar-fill exp-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Minimap & Quick Menu (Top Right) -->
                <div id="minimap-container">
                    <div class="minimap-header">Yurika Map</div>
                    <canvas id="minimapCanvas"></canvas>
                    <div class="minimap-footer">X: <span id="mini-pos-x">0</span> Y: <span id="mini-pos-y">0</span>
                    </div>
                </div>

                <div class="minimap-menu">
                    <div class="menu-btn inventory-trigger" id="btn-inventory" data-key="shift-b" title="Í∞ÄÎ∞©">
                        <div class="menu-icon">üéí</div>
                    </div>
                    <div class="menu-btn skill-trigger" id="btn-skill" data-key="shift-s" title="Ïä§ÌÇ¨">
                        <div class="menu-icon">üìú</div>
                    </div>
                    <div class="menu-btn status-trigger" id="btn-status" data-key="shift-i" title="ÎÇ¥ Ï†ïÎ≥¥">
                        <div class="menu-icon">üë§</div>
                    </div>
                </div>

                <div class="menu-btn fullscreen-toggle" id="btn-fullscreen" title="Ï†ÑÏ≤¥ÌôîÎ©¥">
                    <div class="menu-icon">‚õ∂</div>
                </div>

                <!-- Left Side UI: Quest and Chat Stacking -->
                <div class="left-ui-container">
                    <!-- Quest List (Left) -->
                    <div class="quest-list-panel">
                        <div class="quest-panel-header">
                            <span class="quest-header-icon">üìú</span>
                            <h3>ÏßÑÌñâ Ï§ëÏù∏ ÌÄòÏä§Ìä∏</h3>
                        </div>
                        <div class="quest-content">
                            <!-- Slot 1: Mission Task -->
                            <div class="quest-item" id="quest-task-display">
                                <span class="quest-icon">‚öîÔ∏è</span>
                                <div class="quest-details">
                                    <div class="quest-title" id="active-quest-title">ÌôúÏÑ± ÌÄòÏä§Ìä∏ Ï†ïÎ≥¥</div>
                                    <div class="quest-progress" id="active-quest-task">ÌÄòÏä§Ìä∏Î•º ÏßÑÌñâÌï¥Ï£ºÏÑ∏Ïöî.</div>
                                </div>
                            </div>
                            <!-- Slot 2: Reward Info -->
                            <div class="quest-item" id="quest-reward-display">
                                <span class="quest-icon">üéÅ</span>
                                <div class="quest-details">
                                    <div class="quest-title">ÌÄòÏä§Ìä∏ Î≥¥ÏÉÅ</div>
                                    <div class="quest-progress" id="active-quest-reward">-</div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Chat Window -->
                    <div class="chat-window">
                        <div class="chat-header">
                            <span>üí¨ Chat</span>
                            <div class="chat-controls">
                                <span class="minimize-btn">_</span>
                            </div>
                        </div>
                        <div class="chat-messages">
                            <div class="message incoming">Ïú†Î¶¨Ïπ¥ Ïò®ÎùºÏù∏(Yurika Online)Ïóê Ïò§Ïã†Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§! ‚ú®</div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" placeholder="Î©îÏÑ∏ÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
                            <button class="send-btn">‚ûî</button>
                        </div>
                    </div>
                </div>

                <!-- Joystick & Buttons -->
                <div id="joystick-area"></div>
                <div id="joystick-container">
                    <div id="joystick-base">
                        <div id="joystick-stick">
                            <div class="paw-icon">üêæ</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons">
                    <div class="skill-row top-skills">
                        <div class="skill-btn skill-u" data-key="u">
                            <div class="shortcut-badge">U</div>
                            <div class="inner-icon">üî•</div>
                            <div class="cooldown-overlay"></div>
                            <div class="cooldown-time"></div>
                        </div>
                        <div class="skill-btn skill-k" data-key="k">
                            <div class="shortcut-badge">K</div>
                            <div class="inner-icon">üõ°Ô∏è</div>
                            <div class="cooldown-overlay"></div>
                            <div class="cooldown-time"></div>
                        </div>
                    </div>
                    <div class="skill-row bottom-skills">
                        <div class="skill-btn skill-h" data-key="h">
                            <div class="shortcut-badge">H</div>
                            <div class="inner-icon">ü™Ñ</div>
                            <div class="cooldown-overlay"></div>
                            <div class="cooldown-time"></div>
                        </div>
                        <div class="attack-btn" data-key="j">
                            <div class="shortcut-badge">J</div>
                            <div class="inner-icon">‚öîÔ∏è</div>
                            <div class="cooldown-overlay"></div>
                            <div class="cooldown-time"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Popups -->
        <div id="popup-overlay" class="hidden">
            <!-- Inventory Popup -->
            <div id="inventory-popup" class="game-popup hidden">
                <div class="popup-header">
                    <h2>Í∞ÄÎ∞© (Inventory)</h2>
                    <button class="close-popup pc-only">‚úï</button>
                </div>
                <div class="inventory-grid">
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                    <div class="grid-item"></div>
                </div>
                <div class="popup-footer">
                    <button class="close-btn-bottom close-popup">Îã´Í∏∞</button>
                </div>
            </div>

            <!-- Status Popup -->
            <div id="status-popup" class="game-popup hidden">
                <div class="popup-header">
                    <h2>ÎÇ¥ Ï†ïÎ≥¥ (Status)</h2>
                    <button class="close-popup pc-only">‚úï</button>
                </div>
                <div class="status-content-wrapper">
                    <div class="status-top">
                        <div class="status-portrait"></div>
                        <div class="status-basic-info">
                            <p id="name-display-row"><strong>Ïù¥Î¶Ñ:</strong> <span id="player-name-display"></span> <button
                                    id="player-name-edit-btn"
                                    style="margin-left: 8px; padding: 2px 8px; font-size: 11px; border: 1px solid #ddd; border-radius: 4px; background: #f5f5f5; cursor: pointer;">ÏàòÏ†ï</button>
                            </p>
                            <p id="name-input-row" style="display: none;"><strong>Ïù¥Î¶Ñ:</strong> <input type="text"
                                    id="player-name-input" maxlength="12"
                                    style="width: 120px; padding: 2px 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;" />
                                <button id="player-name-save-btn"
                                    style="padding: 2px 8px; font-size: 11px; border: 1px solid #4ade80; border-radius: 4px; background: #4ade80; color: white; cursor: pointer;">Ï†ÄÏû•</button>
                            </p>
                            <p><strong>ÏßÅÏóÖ:</strong> Ï¥àÎ≥¥ ÎßàÎ≤ïÏÇ¨</p>
                            <p><strong>Î†àÎ≤®:</strong> <span id="stat-level">1</span></p>
                            <div class="exp-bar-container">
                                <span class="exp-label">EXP: <span id="stat-exp-text">0 / 100</span></span>
                                <div class="exp-bar-bg">
                                    <div class="exp-bar-fill" id="stat-exp-fill"></div>
                                </div>
                                <p class="exp-remaining">ÎÇ®ÏùÄ Í≤ΩÌóòÏπò: <span id="stat-exp-remain">100</span></p>
                            </div>
                        </div>
                    </div>

                    <div class="status-stats-grid">
                        <div class="stat-main">
                            <div class="stat-point-info">
                                <span>Î≥¥Ïú† Ìè¨Ïù∏Ìä∏: <strong id="stat-points">0</strong></span>
                            </div>
                            <div class="stat-row-ui">
                                <label>‚ù§Ô∏è Ï≤¥Î†• (VIT)</label>
                                <div class="stat-value-container">
                                    <span id="val-vitality" class="stat-value">5</span>
                                    <div class="stat-controls-row">
                                        <button class="stat-down-btn disabled" data-stat="vitality">-</button>
                                        <button class="stat-up-btn" data-stat="vitality">+</button>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-row-ui">
                                <label>üß† ÏßÄÎ†• (INT)</label>
                                <div class="stat-value-container">
                                    <span id="val-intelligence" class="stat-value">5</span>
                                    <div class="stat-controls-row">
                                        <button class="stat-down-btn disabled" data-stat="intelligence">-</button>
                                        <button class="stat-up-btn" data-stat="intelligence">+</button>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-row-ui">
                                <label>‚ú® ÏßÄÌòú (WIS)</label>
                                <div class="stat-value-container">
                                    <span id="val-wisdom" class="stat-value">5</span>
                                    <div class="stat-controls-row">
                                        <button class="stat-down-btn disabled" data-stat="wisdom">-</button>
                                        <button class="stat-up-btn" data-stat="wisdom">+</button>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-row-ui">
                                <label>‚ö° ÏàúÎ∞úÎ†• (AGI)</label>
                                <div class="stat-value-container">
                                    <span id="val-agility" class="stat-value">5</span>
                                    <div class="stat-controls-row">
                                        <button class="stat-down-btn disabled" data-stat="agility">-</button>
                                        <button class="stat-up-btn" data-stat="agility">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="stat-derived">
                            <div class="derived-row"><span>ÌòÑÏû¨ HP:</span> <span id="val-hp-range">100/100</span></div>
                            <div class="derived-row"><span>ÌòÑÏû¨ MP:</span> <span id="val-mp-range">100/100</span></div>
                            <div class="derived-row"><span>Í≥µÍ≤©Î†•:</span> <span id="val-atk">10</span></div>
                            <div class="derived-row"><span>Î∞©Ïñ¥Î†•:</span> <span id="val-def">0</span></div>
                            <div class="derived-row"><span>Ï≤¥Î†• ÌöåÎ≥µÎ†•:</span> <span id="val-hp-regen">0</span>
                            </div>
                            <div class="derived-row"><span>ÎßàÎÇò ÌöåÎ≥µÎ†•:</span> <span id="val-mp-regen">0</span>
                            </div>
                            <div class="derived-row"><span>Í≥µÍ≤©ÏÜçÎèÑ:</span> <span id="val-atk-spd">1.0</span>
                            </div>
                            <div class="derived-row"><span>ÏπòÎ™ÖÌôïÎ•†:</span> <span id="val-crit">10%</span></div>
                            <div class="derived-row"><span>Ïù¥ÎèôÏÜçÎèÑ:</span> <span id="val-move-spd">100%</span>
                            </div>
                        </div>
                    </div>
                    <button id="reset-character-btn" class="reset-btn hidden"
                        onclick="window.game.ui.confirmResetCharacter()">Ï∫êÎ¶≠ÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
                    <div class="popup-footer">
                        <button class="close-btn-bottom close-popup">Îã´Í∏∞</button>
                    </div>
                </div>
            </div>

            <!-- Skill Popup -->
            <div id="skill-popup" class="game-popup hidden">
                <div class="popup-header">
                    <h2>Ïä§ÌÇ¨ Ìä∏Î¶¨ (Skill Tree)</h2>
                    <button class="close-popup pc-only">‚úï</button>
                </div>
                <div class="skill-content-wrapper">
                    <div class="skill-point-info">
                        Î≥¥Ïú† Í≥®Îìú: <strong id="ui-skill-gold">0</strong>
                    </div>
                    <div class="skill-list">
                        <!-- Skill Item: Laser -->
                        <div class="skill-item">
                            <div class="skill-icon">‚öîÔ∏è</div>
                            <div class="skill-info">
                                <div class="skill-name-row">
                                    <span class="skill-name">Ï≤¥Ïù∏ ÎùºÏù¥Ìä∏Îãù</span>
                                    <span class="skill-level">Lv.<span id="lvl-laser">1</span></span>
                                </div>
                                <p class="skill-desc">Ïó∞ÏáÑÌòï Í∏∞Î≥∏Í≥µÍ≤© (Ï†ÑÍ∏∞ÏÜçÏÑ±). <br>Ï†ÅÏ§ë Ïãú ÎåÄÏÉÅ Î≥Ñ +1 ÌöåÎ≥µ. <small>ÌïÑÏöî:
                                        <span class="skill-cost" data-skill="laser">300</span>G</small></p>
                            </div>
                            <button class="skill-up-btn" data-skill="laser">+</button>
                        </div>
                        <!-- Skill Item: Missile -->
                        <div class="skill-item">
                            <div class="skill-icon">ü™Ñ</div>
                            <div class="skill-info">
                                <div class="skill-name-row">
                                    <span class="skill-name">Îß§ÏßÅ ÎØ∏ÏÇ¨Ïùº</span>
                                    <span class="skill-level">Lv.<span id="lvl-missile">1</span></span>
                                </div>
                                <p class="skill-desc">Ïú†ÎèÑ Îã®Ïùº Í≥µÍ≤©. <br><small>ÌïÑÏöî: <span class="skill-cost"
                                            data-skill="missile">300</span>G</small></p>
                            </div>
                            <button class="skill-up-btn" data-skill="missile">+</button>
                        </div>
                        <!-- Skill Item: Fireball -->
                        <div class="skill-item">
                            <div class="skill-icon">üî•</div>
                            <div class="skill-info">
                                <div class="skill-name-row">
                                    <span class="skill-name">ÌååÏù¥Ïñ¥Î≥º</span>
                                    <span class="skill-level">Lv.<span id="lvl-fireball">1</span></span>
                                </div>
                                <p class="skill-desc">Í¥ëÏó≠ Ìè≠Î∞ú Î∞è ÌôîÏÉÅ Í≥µÍ≤©. <br><small>ÌïÑÏöî: <span class="skill-cost"
                                            data-skill="fireball">300</span>G</small></p>
                            </div>
                            <button class="skill-up-btn" data-skill="fireball">+</button>
                        </div>
                        <!-- Skill Item: Shield -->
                        <div class="skill-item">
                            <div class="skill-icon">üõ°Ô∏è</div>
                            <div class="skill-info">
                                <div class="skill-name-row">
                                    <span class="skill-name">Ïï±ÏÜîÎ£®Ìä∏ Î≤†Î¶¨Ïñ¥</span>
                                    <span class="skill-level">Lv.<span id="lvl-shield">1</span></span>
                                </div>
                                <p class="skill-desc">Îç∞ÎØ∏ÏßÄ ÎßàÎÇò Ìù°Ïàò Î∞è Î∞©Ïñ¥. <br><small>ÌïÑÏöî: <span class="skill-cost"
                                            data-skill="shield">300</span>G</small>
                                </p>
                            </div>
                            <button class="skill-up-btn" data-skill="shield">+</button>
                        </div>
                    </div>
                </div>
                <div class="popup-footer">
                    <button class="close-btn-bottom close-popup">Îã´Í∏∞</button>
                </div>
            </div>
        </div>

        <!-- Death Modal -->
        <div id="death-modal" class="hidden">
            <div class="death-content">
                <div class="death-icon">üíÄ</div>
                <h2>ÏÇ¨ÎßùÌïòÏÖ®ÏäµÎãàÎã§</h2>
                <p id="death-timer-text">3Ï¥à ÌõÑ Î∂ÄÌôú Í∞ÄÎä•Ìï©ÎãàÎã§...</p>
                <button id="retry-btn" class="hidden">Ïû¨ÎèÑÏ†Ñ</button>
            </div>
        </div>

        <!-- Confirm Modal (Modern UI) -->
        <div id="confirm-modal" class="hidden">
            <div class="confirm-content">
                <p id="confirm-message">Ïä§ÌÖüÏùÑ Ï†ÄÏû•ÌïòÏãúÍ≤†ÏäµÎãàÍπå?<br><small>ÌïúÎ≤à Ï†ÄÏû•ÌïòÎ©¥ Î≥ÄÍ≤ΩÌï† Ïàò ÏóÜÏäµÎãàÎã§.</small></p>
                <div class="confirm-buttons">
                    <button id="confirm-yes">ÌôïÏù∏</button>
                    <button id="confirm-no">Ï∑®ÏÜå</button>
                </div>
            </div>
        </div>

        <!-- Skill Tooltip -->
        <div id="skill-tooltip" class="hidden">
            <div class="tooltip-name">Ïä§ÌÇ¨ Ïù¥Î¶Ñ</div>
            <div class="tooltip-desc">ÏÑ§Î™Ö</div>
        </div>

        <!-- Touch Feedback -->
        <div id="touch-pointer" class="hidden"></div>
    </div>

    <!-- Reward Modal -->
    <div id="reward-modal" class="confirm-modal-overlay hidden">
        <div class="confirm-modal-content reward-content">
            <h2 id="reward-title">ÌÄòÏä§Ìä∏ ÏôÑÎ£å!</h2>
            <p id="reward-message">Î≥¥ÏÉÅÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§.</p>
            <button class="confirm-btn" onclick="window.game.ui.hideRewardModal()">ÌôïÏù∏</button>
        </div>
    </div>

    <!-- Update History UI -->
    <div class="version-info" onclick="window.game.ui.toggleUpdateHistory()">
        üì¶ v0.29.19
    </div>




    <!-- Update History Modal -->
    <div id="history-modal" class="confirm-modal-overlay hidden">
        <div class="confirm-modal-content history-content">
            <div class="history-header">
                <h2>ÏóÖÎç∞Ïù¥Ìä∏ ÌûàÏä§ÌÜ†Î¶¨ üìú</h2>
                <button class="close-history" onclick="window.game.ui.toggleUpdateHistory()">√ó</button>
            </div>
            <div id="history-list" class="history-list">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <script type="module" src="./src/js/main.js?v=0.26.0"></script>

    <!-- Developer Overlay -->
    <div id="dev-overlay" class="dev-overlay hidden">
        <div class="dev-stat">Monsters: <span id="dev-m-count">0</span>/<span id="dev-m-max">10</span></div>
        <div class="dev-stat">Respawn: <span id="dev-m-interval">5s</span></div>
        <div class="dev-stat">Total Level: <span id="dev-p-sum">1</span></div>
    </div>
</body>

</html>