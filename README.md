# 🎮 Yurika Online (유리카 온라인)
> **Service Link:** [https://yurika-online.web.app/](https://yurika-online.web.app/)


**Yurika Online**은 HTML5 Canvas와 Firebase를 기반으로 구축된 최첨단 에이전트 기반 MMORPG입니다. 이 프로젝트는 현대적인 웹 기술을 사용하여 부드러운 멀티플레이어 경험과 화려한 마법 전투 시스템을 구현하는 것을 목표로 합니다.

현재 버전: **0.00.39**

---

## 🚀 주요 기능

- **실시간 PvP 및 파티 시스템 (New)**: 적대 선언을 통한 대인전(PvP)과 파티 결성을 통한 협동 플레이(Exp/Gold 분배)를 지원합니다.
- **실시간 멀티플레이어**: Firebase Realtime Database를 통한 실시간 위치 동기화 및 전투 시스템.
- **다이내믹 전투 시스템**:
  - **체인 라이트닝**: 다수의 적을 연쇄 타격하는 광역 기술.
  - **매직 미사일**: 유도 성능을 가진 마법 투사체 (PvP 지원).
  - **파이어볼**: 강력한 폭발을 일으키는 광역 화염 마법 (PvP 지원).
  - **앱솔루트 베리어**: 어떠한 공격도 막아내는 절대 방어막 (시각 효과 동기화).
- **스마트 몬스터 AI**: 플레이어를 감지하고 추적하며, 그룹으로 협력하여 공격하는 지능형 AI 패턴.
- **퀘스트 & 보상**: 슬라임 처치 퀘스트와 대왕 슬라임 레이드를 통한 캐릭터 성장 시스템.
- **사용자 커스터마이징**: 구글 로그인을 통한 간편한 세션 유지 및 캐릭터 이름/스탯 커스터마이징.
- **자동 버전 관리**: 서버 버전 변경 시 클라이언트 자동 새로고침 및 무한 루프 방지 시스템.

---

## 🛠️ 기술 스택

- **Frontend**: Vanilla JavaScript (ES6+), HTML5 Canvas, CSS3
- **Backend/DB**: Firebase Authentication, Firebase Realtime Database
- **Build/Dev**: Live-server (PWA 지원)

---

## 📋 최신 업데이트 내역 (0.00.39)

### 0.00.39 - 플레이어 동기화 및 번개 이펙트 수정
- **화면 밖 플레이어 동기화**: 화면 밖에 있던 플레이어가 들어와도 정상 표시됩니다.
- **번개 줄기 fallback 제거**: 타깃 없음 시 상대 화면에 가짜 번개 표시 방지.

### 0.00.38 - 체인 라이트닝 채널링 종료 동기화
- **뤤 동기화 버그 수정**: J키를 떼면 상대 화면에서도 체인 라이트닝 시전이 즉시 종료됩니다.
- **무한 시전 버그 해결**: 타깃 없이 스킬 시전 시 상대 화면에서 무한히 공격하는 버그가 해결되었습니다.

### 0.00.37 - 시전 이펙트 동기화
- **상대 화면에서도 시전 이펙트 표시**: 타깃 없이 스킬을 시전해도 공격모션, 스파크, 마법진이 상대 화면에 표시됩니다.
- **공격 이펙트는 타깃 있을 때만**: 번개 줄기, 미사일은 유효한 타깃이 있을 때만 동기화됩니다.

### 0.00.36 - 스킬 네트워크 동기화 수정
- **체인 라이트닝**: 유효한 타깃이 있을 때만 네트워크 패킷 전송 (빈 타깃 시 상대 화면 번개 안보임)
- **매직 미사일**: 타깃 발견 후에만 패킷 전송 (타깃 없으면 상대 화면에 이펙트 안보임)

### 0.00.35 - 체인 라이트닝 PvP 시각 효과 수정
- **적대 목록 미포함 대상**: 상대 화면에서도 번개 이펙트가 표시되지 않습니다.
- **유효한 타깃만 동기화**: synced target ID를 기반으로 시각 효과가 표시됩니다.

### 0.00.34 - 전투 밸런스 및 시스템 안정화
- **최소 데미지 보장**: 몬스터에게 가해지는 모든 데미지가 최소 1로 보정됩니다 (방어력 무시).
- **매직 미사일 상향**: 발사 수가 레벨당 2발로 증가했습니다 (Lv1: 2발). 데미지 계수는 45%로 조정되었습니다.
- **UI 개선**: 스킬 트리 창에서 아이템 드래그/선택이 방지되어 터치 경험이 개선되었습니다.
- **버전 포맷 변경**: 버전 표기에서 불필요한 접두어를 제거하여(`0.00.34`) 가독성을 높였습니다.

### v0.00.29 - 위치 저장 및 복원
- **위치 저장**: 로그아웃 시 현재 위치(x, y)가 저장됩니다.
- **위치 복원**: 재접속 시 마지막 위치에서 시작합니다.

### v0.00.28 - 마나 플로팅 텍스트 복구
- **마나 사용 시**: 파란색 `-사용량` 플로팅 텍스트 표시
- **마나 회복 시**: 하늘색 `+회복량` 플로팅 텍스트 표시 (체인 라이트닝 포함)

### v0.00.27 - 체인 라이트닝 최소 데미지 보장
- **최소 데미지 1**: 체인 라이트닝 초기 데미지가 공격력의 10% (올림, 최소 1)로 보장됩니다.

### v0.00.26 - PvP 상태 효과 개선
- **감전 효과 적용**: 적대 플레이어(호스타일 대상)에게도 체인 라이트닝 감전 효과가 적용됩니다.
- **상태 효과 아이콘**: 화상/감전 효과가 로컬 플레이어와 상대 플레이어에게 모두 아이콘으로 표시됩니다 (몬스터와 동일).

### v0.00.25 - 체인 라이트닝 마나 회복 복구
- **타격당 MP +1 회복**: 체인 라이트닝 타격 시 마나가 1씩 회복됩니다 (체인된 모든 대상 포함).
- **플로팅 텍스트**: 회복 시 캐릭터 위에 파란색 `+1` 텍스트가 표시됩니다.

### v0.00.24 - 동기화 범위 확대
- **viewMargin 증가**: 화면 밖 동기화 범위를 200px에서 500px로 확대하여 플레이어/몬스터가 화면 진입 전 미리 동기화됩니다.
- **깜빡임 현상 해결**: 개체가 갑자기 나타나는 현상이 완화됩니다.

### v0.00.23 - Phase 2 Firebase 동기화 최적화
- **동적 Heartbeat**: 이동 시 1초, 정지 시 5초 간격으로 자동 조절되어 트래픽을 절감합니다.
- **몬스터 동기화 최적화**: 화면 내 2초, 화면 밖 5초 간격으로 분리하여 대역폭 사용량을 줄입니다.

### v0.00.22 - 성능 최적화 - Off-screen Culling
- **화면 밖 개체 처리 억제**: 카메라 뷰포트 밖의 플레이어와 몬스터는 업데이트 및 렌더링을 생략하여 CPU/GPU 부하를 대폭 절감합니다.
- **미니맵 동기화 유지**: 화면 밖 개체도 미니맵에서는 정상적으로 표시됩니다.
- **예상 성능 향상**: 업데이트/렌더링 호출 ~50-70% 감소

### v0.00.21 - 타게팅 조작성 및 시인성 개선
- **타게팅 판정 범위 확대**: 개체의 중심 기준 50px 내외 클릭 시에도 대상으로 지정되도록 판정을 대폭 완화했습니다.
- **시각적 락온(Lock-on) 효과**: 선택된 대상의 발밑에 회전하는 붉은색 마법진 조준선이 표시되어 대상을 명확히 인지할 수 있습니다.
- **타겟 자동 해제**: 대상이 사망하면 자동으로 타겟팅이 해제되도록 개선했습니다.

### v0.00.20 - PC PvP 타게팅 및 동기화 개선
- **PC 타게팅 시스템 도입**: 마우스 클릭으로 몬스터나 플레이어를 대상으로 지정할 수 있습니다.
- **적대 동기화 보강**: 네트워크 패킷 구조 개선을 통해 실시간 적대 상태 반영의 정확도를 높였습니다.
- **스킬 우선순위 적용**: 매직 미사일과 체인 라이트닝이 현재 선택된 대상(`currentTarget`)을 우선적으로 공격합니다.
- **데이터 구조 통합**: 원격 플레이어 진입 시 적대 정보를 즉시 초기화하여 PvP 초기 대응 속도를 개선했습니다.

### PvP 즉시 활성화 및 동기화 개선 (v0.00.19)
- ** PvP 선포 즉시 적용**:
  - 적대 선언 명령(` /e`) 및 해제 시 데이터 동기화 우선순위를 높여, 별도의 딜레이 없이 즉시 상호 공격 혹은 평화 상태가 되도록 개선했습니다.
- **자동 반격 시스템 복구**:
  - 플레이어에게 공격받았을 때, 상대방을 자동으로 내 적대 목록에 추가하여 즉각적인 전투 대응이 가능하도록 했습니다.
- **네트워크 데이터 정합성 강화**:
  - 동기화 방식의 차이로 발생하던 적대 상태 인지 오류를 방지하기 위해 데이터 파싱 로직을 최적화했습니다.

## 📋 이전 업데이트 내역 (v0.00.18)

### 적대 목록 중복 방지 및 안정화 (v0.00.18)
- **적대 목록 이름 중복 방지**:
  - UID가 다르더라도 닉네임이 같으면 중복으로 등록되지 않도록 로직을 강화했습니다.
  - `/e [닉네임]` 명령어로 해제 시, 이름 기반 검색을 통해 대상을 정확히 찾아 처리합니다.
- **네트워크 동기화 최적화**:
  - 상대방으로부터 적대 이벤트를 수신할 때도 이름 중복 여부를 먼저 체크하여 목록의 무결성을 유지합니다.

## 📋 이전 업데이트 내역 (v0.00.17)

### 모바일 채팅 편의성 강화 (v0.00.17)
- **모바일 채팅 중복 입력 수정**:
  - 모바일 환경에서 채팅 전송 시 메시지가 두 번 입력되는 버그를 수정했습니다. 메시지 전송 즉시 입력창을 비우고 이벤트 전파를 최적화하여 안정성을 높였습니다.
- **적대 해제 편의성 개선**:
  - 적대 목록의 'x' 버튼에 확인 절차를 추가하기 위한 기반 작업을 수행했습니다. (추후 모달 시스템 통합 예정)

### 상호 적대 동기화 및 타겟팅 정교화 (v0.00.16)
- **상호 적대 실시간 동기화 개선**:
  - 적대 선언, 레벨, 파티 정보가 위치 업데이트 패킷에 포함되어 실시간으로 모든 클라이언트에 브로드캐스트되도록 개선했습니다.
  - 이제 새로고침 없이도 즉시 상대방의 적대 상태를 인식하여 PvP가 가능합니다.
- **적대 해제 로직 정상화**:
  - UI의 적대 목록에서 'x' 버튼을 통해 해제할 때, 상대방에게도 해제 이벤트가 전송되도록 수정하여 완벽한 상호 해제가 가능해졌습니다.
  - 적대 해제는 선포 후 30초의 쿨타임이 적용되며, 시스템 메시지를 통해 남은 시간을 알 수 있습니다.
- **매직 미사일 타겟팅 정교화**:
  - 몬스터와 플레이어 개체에 명시적인 `type` 속성을 부여하여 타겟팅 정확도를 높였습니다.
  - 비적대 플레이어를 몬스터로 오인하여 공격하던 예외 상황을 원천 차단했습니다.
- **시스템 메시지 및 UI 개선**:
  - 적대 선언 및 해제 시 상대방의 닉네임이 정확히 표시되도록 시스템 메시지를 개선했습니다.
  - 버전 표기 및 캐시 제어 로직을 통합 관리하도록 최적화했습니다.

### 적대 시스템 및 동기화 개선 (v0.00.15)
- **적대 목록(Hostility List) 버그 수정**:
  - `canAttackTarget` 메서드의 무한 재귀 호출로 인해 게임이 중단되던 현상을 수정했습니다.
  - 적대 목록 UI에서 상대방 이름이 `[object Object]`ㅁ 또는 `undefined`로 표시되던 문제를 해결했습니다.
  - 재접속 시에도 적대 목록 데이터가 정상적으로 유지되도록 데이터 구조와 저장 로직을 개선했습니다.
  - 자동 반격 시 데이터 구조 오류로 인해 발생하던 Firebase 저장 실패 문제를 해결했습니다.
- **캐릭터 사망 동기화 개선**:
  - 플레이어가 사망했을 때 즉각적인 네트워크 동기화를 수행하여, 상대방 화면에서도 즉시 비석(Tombstone)으로 변하도록 개선했습니다.

### 시스템 안정화 및 AI 개선 (v0.00.14)
- **몬스터 AI 최적화**: 
  - 몬스터가 화면 밖에 있더라도 호스트 플레이어의 월드에서는 AI 연산과 이동이 정상적으로 진행되도록 초기화 로직을 개선했습니다.
  - 호스트 판정 주기를 매 초 단위로 강화하여 1인 플레이 및 호스트 전환 시의 안정성을 높였습니다.
- **데이터 지속성(Persistence) 강화**:
  - 캐릭터 선택 후 월드 진입 시 퀘스트 데이터가 누락되거나 초기화되는 현상을 방지하기 위해 프로필 데이터 구조를 보강했습니다.
  - 경험치와 퀘스트 진행도가 저장될 때의 유효성 검사 및 로그 시스템을 강화했습니다.
- **부활 시스템 수정**:
  - 사망 후 '재도전' 버튼 클릭 시 발생하던 `TypeError`를 해결하고 부활 로직을 통합했습니다.
  - 부활 시 즉각적인 네트워크 동기화를 통해 다른 플레이어에게 보이는 묘비 이펙트가 즉시 사라지도록 개선했습니다.
- **네트워크 최적화**: Realtime DB 사용량 관리를 위해 몬스터 위치 동기화 주기를 기존의 안정적인 2초 주기로 유지하며 효율성을 높였습니다.

### 파티 및 PvP 시스템 (v0.00.14)
- **PvP 시스템**: 
  - `/e [닉네임]` 명령어로 적대 선언 가능.
  - 피격 시 자동으로 상대를 적대 목록에 추가하는 자동 반격 시스템 탑재.
  - 적대 관계가 아닌 경우 광역 피해를 입지 않도록 안전장치 적용.
  - 우측 적대 패널을 통해 적 목록 확인 및 관리 가능.
- **파티 시스템**:
  - `/p [닉네임]` 명령어로 파티 초대 및 수락/거절 모달 구현.
  - 좌측 파티 패널에 파티원 상태(HP) 실시간 표시.
  - 파티 결성 시 적대 관계 자동 해제.
  - **보상 공유**: 획득한 경험치와 골드를 파티원 수만큼 균등 분배(1/N).

### 버그 수정 및 안정화 (v0.00.13)
- **에셋 로딩 버그 수정**: 네트워크 속도 이슈로 일부 몬스터가 투명하게 보이던 현상을 수정 (이미지 프리로드 및 에러 핸들링 강화).
- **서비스 워커 강화**: 배포 시 즉각적인 업데이트 반영을 위해 캐시 버전 관리 로직을 고도화했습니다.

### PvP 및 스킬 동기화 (v0.00.06)
- **PvP 타겟팅 시스템 구축**: `Projectile.js`를 전면 개편하여 몬스터뿐만 아니라 플레이어 간 전투(PvP)를 완벽하게 지원합니다.
  - **매직 미사일**: 상대 플레이어를 인식하여 자동으로 유도됩니다.
  - **파이어볼**: 상대 플레이어에게 적중 시 정상적으로 폭발 및 피격 이펙트가 발생합니다.
  - **앱솔루트 베리어**: 상대방 화면에서도 방어막 이펙트가 피격 전까지 영구적으로 표시되도록 개선되었습니다.
- **자폭 방지**: 투사체에 `ownerId`를 부여하여 자신이 쏜 마법에 자신이 피격되는 현상을 방지했습니다.

### 시스템 안정성 (v0.00.04)
- **버전 체크 시스템 근본 개선**: `version.txt`를 단일 진실 공급원(SSOT)으로 사용하도록 변경했습니다.
- **무한 리로드 방지**: `localStorage`와 `sessionStorage`를 활용하여 버전 불일치로 인한 무한 새로고침 루프를 원천 차단했습니다.

### 게임 밸런스 및 UI (v0.00.01 ~ v0.00.03)
- **몬스터 스폰 밸런스**: 몬스터 최대 개체 수를 15마리로 늘리고, 리스폰 시간을 3초로 단축하여 전투 템포를 높였습니다.
- **UI 개선**: 우측 하단에 현재 버전을 실시간으로 표시하며, 스테이터스 창에 구글 연동 버튼을 추가했습니다.
- **개발자 도구**: UID 조회를 위한 검색 기능을 추가하여 운영 편의성을 높였습니다.

---

## 🕹️ 시작하기

1. 저장소를 클론합니다.
2. `npm start` 명령어로 로컬 서버를 실행합니다.
3. 브라우저가 자동으로 열리지 않는다면 `http://localhost:8080` (또는 8081)에 접속하여 게임을 즐기세요!

---

## ⚖️ 저작권 및 라이선스

© 2026 Yurika Online. All rights reserved.
이 프로젝트는 개인 개발용이며 imc git에는 커밋하지 않습니다.
